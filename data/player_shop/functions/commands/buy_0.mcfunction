# Buy amount has be less than 64!
execute if score @s ps_buy_0 matches 65.. run tellraw @s [{"text": "[", "color": "white"}, {"text": "Mr_Chibi's Player Shop", "color": "aqua"}, {"text": "] ", "color": "white"}, {"text": "Error, you can only buy 64 items or less!", "color": "red"}]
execute if score @s ps_buy_0 matches 65.. run playsound minecraft:item.firecharge.use master @s ~ ~ ~ 1 0.8

# Count how many items the shop has to "Sell":
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:18b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:19b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:20b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:20b}].Count
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:18b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:19b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:19b}].Count
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:18b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:18b}].Count
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:11b}].Count
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:10b}].Count
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:9b}].Count
execute if score @s ps_buy_0 matches ..64 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} store result score @s ps_sell_0 run data get block ~ ~-1 ~ Items[{Slot:2b}].Count


# Not Enough Stock in Shop!
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 > @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run tellraw @s [{"text": "[", "color": "white"}, {"text": "Mr_Chibi's Player Shop", "color": "aqua"}, {"text": "] ", "color": "white"}, {"text": "Error, there's not enough stock in the shop!", "color": "red"}]
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 > @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run playsound minecraft:item.firecharge.use master @s ~ ~ ~ 1 0.8


# Match Sell Price to Buy Price:
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s store result score @s ps_buying_0 run data get block ~ ~-1 ~ Items[{Slot:0b}].Count
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s store result block ~ ~-1 ~ Items[{Slot:0b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0



# change to sell <amount>:
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:18b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:19b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:20b}]} store result block ~ ~-1 ~ Items[{Slot:20b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:18b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:19b}]} store result block ~ ~-1 ~ Items[{Slot:19b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:18b}]} store result block ~ ~-1 ~ Items[{Slot:18b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:11b}]} store result block ~ ~-1 ~ Items[{Slot:11b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:10b}]} store result block ~ ~-1 ~ Items[{Slot:10b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s unless block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:9b}]} store result block ~ ~-1 ~ Items[{Slot:9b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s if block ~ ~-1 ~ minecraft:chest{Items:[{Slot:2b}]} store result block ~ ~-1 ~ Items[{Slot:2b}].Count byte 1 run execute as @p at @s run scoreboard players get @s ps_buy_0

# Remaining Stock:
execute if score @s ps_buy_0 matches ..64 if score @s ps_buy_0 <= @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] ps_sell_0 run execute as @e[type=minecraft:villager,tag=player_shop,sort=nearest,limit=1] at @s run scoreboard players operation @s ps_sell_0 -= @p ps_buy_0

# Reset
scoreboard players set @s ps_buy_0 0